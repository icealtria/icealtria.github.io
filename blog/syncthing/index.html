<!DOCTYPE html><html lang="zh-cn"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v4.10.0"><!-- Canonical URL --><link rel="canonical" href="https://icealtria.github.io/blog/syncthing/"><!-- Primary Meta Tags --><title>终究还是用回了 Syncthing</title><meta name="title" content="终究还是用回了 Syncthing"><meta name="description" content="主要是吐槽 Dropbox"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://icealtria.github.io/blog/syncthing/"><meta property="og:title" content="终究还是用回了 Syncthing"><meta property="og:description" content="主要是吐槽 Dropbox"><meta property="og:image" content="https://icealtria.github.io/assets/Uninstall_Dropbox.webp"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://icealtria.github.io/blog/syncthing/"><meta property="twitter:title" content="终究还是用回了 Syncthing"><meta property="twitter:description" content="主要是吐槽 Dropbox"><meta property="twitter:image" content="https://icealtria.github.io/assets/Uninstall_Dropbox.webp"><link rel="stylesheet" href="/assets/about.css"></head> <body class="bg-background"> <header> <img class="mt-4 px-2 h-28 mx-auto dark:invert" draggable="false" src="/header.svg" alt="header"> <nav> <div class="flex justify-center my-4"> <a href="/" class="header-link flex items-center gap-1"> <svg viewBox="0 0 24 24" astro-icon="ic:baseline-home"><path fill="currentColor" d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>首页 </a> <a href="/blog" class="header-link flex items-center gap-1"> <svg viewBox="0 0 24 24" astro-icon="ic:baseline-archive"><path fill="currentColor" d="m20.54 5.23-1.39-1.68C18.88 3.21 18.47 3 18 3H6c-.47 0-.88.21-1.16.55L3.46 5.23C3.17 5.57 3 6.02 3 6.5V19c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V6.5c0-.48-.17-.93-.46-1.27zM12 17.5 6.5 12H10v-2h4v2h3.5L12 17.5zM5.12 5l.81-1h12l.94 1H5.12z"/></svg> 归档 </a> <!-- <HeaderLink href="/friends">
      <Icon name="ic:baseline-contacts" />友链
    </HeaderLink> --> <a href="/about" class="header-link flex items-center gap-1"> <svg viewBox="0 0 24 24" astro-icon="ic:baseline-info"><path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>关于 </a> </div> </nav> </header> <div class="mx-auto px-4">  <main class="max-w-4xl mx-auto rounded-2xl"> <img src="/assets/Uninstall_Dropbox_ZEtgXV.webp" class="w-full rounded-2xl shadow-xl" alt="img of 终究还是用回了 Syncthing" loading="eager" width="1000" height="608" decoding="async"> <article> <div> <h1 class="mb-0">终究还是用回了 Syncthing</h1> <div class="text-sm font-light mt-4"> <span>icealtria</span><br> <time datetime="2024-04-10T00:00:00.000Z"> 2024. 4. 10. </time> </div> <div class="tags"><a class="tag" href="/tags/syncthing">
#syncthing</a><a class="tag" href="/tags/backup">
#backup</a></div> </div> <h2 id="我使用过的同步软件">我使用过的同步软件</h2>
<p>我在很长一段时间里一直使用 Dropbox，MegaSync 也用过一段时间。至于为什么选择这两个，是因为主流网盘中提供 Linux 客户端的除了 PCloud 就只有这两个了。</p>
<p>起初我在用 Mega，因为我将密码管理器从 Bitwarden 更换为 KeePassXC，我想将密码库同步到手机上，但当时 KeePass2Android 不支持。现在虽然支持了，但还没完全支持，例如无法登录开启 <a href="https://github.com/PhilippC/keepass2android/issues/2415">2FA</a> 的账号，而 KeePassDX 也用不了。Dropbox 支持在系统的文件选择器中选择文件，因此手机上的两个软件都可以支持。</p>
<p>不过我最终还是放弃了这两个云同步软件，只留下了 Syncthing。Syncthing 我其实一直在用，但之前都只是在电脑上使用。对于在手机上使用，我曾担心它会耗电，但后来发现这个担心是多余的。</p>
<h2 id="批评-dropbox">批评 Dropbox</h2>
<p>为什么要抛弃 Dropbox，那要从我给 Obsidian 写一个插件说起。Obsidian 的插件是用 JavaScript 编写的，每个 JS 项目都会有一坨 <code>node_modules</code>，然后它把这个文件夹同步过去。</p>
<p>我以为在 GUI 里设置选择性同步可以忽略掉这个文件夹，但我搞错了。Dropbox 只能用一种很别扭的方式忽略一个文件夹：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#6A737D"># linux</span></span>
<span class="line"><span style="color:#B392F0">attr</span><span style="color:#79B8FF"> -s</span><span style="color:#9ECBFF"> com.dropbox.ignored</span><span style="color:#79B8FF"> -V</span><span style="color:#79B8FF"> 1</span><span style="color:#9ECBFF"> '/home/yourname/Dropbox (Personal)/YourFileName.pdf'</span></span>
<span class="line"><span style="color:#6A737D"># windog</span></span>
<span class="line"><span style="color:#B392F0">Set-Content</span><span style="color:#79B8FF"> -Path</span><span style="color:#9ECBFF"> 'C:\Users\yourname\Dropbox(Personal)\YourFileName.pdf'</span><span style="color:#79B8FF"> -Stream</span><span style="color:#9ECBFF"> com.dropbox.ignored</span><span style="color:#79B8FF"> -Value</span><span style="color:#79B8FF"> 1</span></span>
<span class="line"></span></code></pre>
<p>这就没办法在文件创建之前忽略掉这个文件了，想忽略多个文件还要逐个操作。</p>
<p>而 syncthing 和 MEGA 只需要简单写个规则。</p>
<p>不止如此。。。</p>
<p>Dropbox 只能将本地的一个文件夹与服务器同步，但我不喜欢将一切都放到 ~/Dropbox。我希望能将 <code>~/Docs</code> 与 <code>%USERPROFILE%/Docs</code>，<code>~/Books</code> 与 <code>D:/Books</code> 同步。</p>
<p>Syncthing 和 Mega 都能做到。</p>
<p>在 Gnome 上 Dropbox 的托盘完全是坏的，这个问题存在了数年，虽然不知道是谁的锅，但只在 Dropbox 上遇到过。右键点击托盘图标打开菜单只能随缘，即便打开显示的状态也是不更新的，永远 “Connecting…”，当然实际上工作的。它只能作为设置页的入口。</p>
<p>同步相关的功能比 Syncthing 和 Mega 更匮乏，但占用内存却是最大的。</p>
<p>槽点这么多，那干脆不用了。我都不知道为什么忍了它这么久。</p>
<p>(说起来 MEGAsync 算是我较为满意的一个网盘了)</p>
<h2 id="如何实现-3-2-1-备份">如何实现 3-2-1 备份</h2>
<p>我使用同步软件的其中一个原因是希望实现 3-2-1 备份，以避免本地机器故障。所谓 3-2-1 备份策略，即保存三份数据备份，使用两种不同的存储介质，并确保至少有一份备份存储在异地。</p>
<p>为了实现这个策略，我采用了 Restic 进行定期备份。它支持数据加密和压缩快照。还可以调用 rclone 的服务作为远程 repo。</p>
<p>具体来说，我编写了一个定期执行的脚本，通过 Restic 进行备份操作。为了确保备份的安全性，我将备份库（repo）的密码存储在 Gnome Keyring 中。脚本会调用 <code>secret-tool</code> 从 Gnome Keyring 中取出密码，并用来解密备份库进行备份。</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#B392F0">restic</span><span style="color:#79B8FF"> -r</span><span style="color:#9ECBFF"> rclone:</span><span style="color:#F97583">&#x3C;</span><span style="color:#9ECBFF">remot</span><span style="color:#E1E4E8">e</span><span style="color:#F97583">></span><span style="color:#9ECBFF">:/path/to/repo</span><span style="color:#9ECBFF"> backup</span><span style="color:#9ECBFF"> /path/to/data</span><span style="color:#79B8FF"> --password-command</span><span style="color:#9ECBFF"> 'secret-tool lookup restic pass'</span></span>
<span class="line"></span></code></pre> </article> <div class="mx-4 md:mx-8 md:py-2"> <div class="comment mx-auto text-center"> <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).only=e;window.dispatchEvent(new Event("astro:only"));})();;(()=>{var A=Object.defineProperty;var g=(i,o,a)=>o in i?A(i,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[o]=a;var d=(i,o,a)=>g(i,typeof o!="symbol"?o+"":o,a);{let i={0:t=>m(t),1:t=>a(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(a(t)),5:t=>new Set(a(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t)},o=t=>{let[l,e]=t;return l in i?i[l](e):void 0},a=t=>t.map(o),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([l,e])=>[l,o(e)]));class y extends HTMLElement{constructor(){super(...arguments);d(this,"Component");d(this,"hydrator");d(this,"hydrate",async()=>{var b;if(!this.hydrator||!this.isConnected)return;let e=(b=this.parentElement)==null?void 0:b.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let c=this.querySelectorAll("astro-slot"),n={},h=this.querySelectorAll("template[data-astro-template]");for(let r of h){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of c){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("name")||"default"]=r.innerHTML)}let p;try{p=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",v=this.getAttribute("component-export");throw v&&(s+=` (export ${v})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}let u;await this.hydrator(this)(this.Component,p,n,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});d(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),c.disconnect(),this.childrenConnectedCallback()},c=new MutationObserver(()=>{var n;((n=this.lastChild)==null?void 0:n.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});c.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}async start(){let e=JSON.parse(this.getAttribute("opts")),c=this.getAttribute("client");if(Astro[c]===void 0){window.addEventListener(`astro:${c}`,()=>this.start(),{once:!0});return}try{await Astro[c](async()=>{let n=this.getAttribute("renderer-url"),[h,{default:p}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),u=this.getAttribute("component-export")||"default";if(!u.includes("."))this.Component=h[u];else{this.Component=h;for(let f of u.split("."))this.Component=this.Component[f]}return this.hydrator=p,this.hydrate},e,this)}catch(n){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,n)}}attributeChangedCallback(){this.hydrate()}}d(y,"observedAttributes",["props"]),customElements.get("astro-island")||customElements.define("astro-island",y)}})();</script><astro-island uid="Z2khmlc" component-url="/_astro/Comment.BsfGVHdc.js" component-export="default" renderer-url="/_astro/client.Cx1FBVJX.js" props="{}" ssr="" client="only" opts="{&quot;name&quot;:&quot;Comment&quot;,&quot;value&quot;:&quot;svelte&quot;}"></astro-island> <noscript>Javascript is required</noscript> </div> </div> </main>  <footer class="gap-2 my-8 flex justify-center items-center">
Copyright &copy; 2024 <span>icealtria</span>|
<a href="/atom.xml">RSS</a> </footer> </div> </body></html> 