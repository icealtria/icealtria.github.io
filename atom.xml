<?xml version="1.0" encoding="UTF-8"?><rss version="2.0" xmlns:content="http://purl.org/rss/1.0/modules/content/"><channel><title>icealtria&apos;s blog</title><description>A simple blog theme for Astro</description><link>https://icealtria.github.io/</link><item><title>给运行在局域网内的服务添加 https</title><link>https://icealtria.github.io/blog/https-lan/</link><guid isPermaLink="true">https://icealtria.github.io/blog/https-lan/</guid><description>使用 Tailscale 实现</description><pubDate>Mon, 06 May 2024 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;这是一个很奇怪的需求，在大多数情况下，局域网内的设备是相互信任的，https 似乎是件没有什么必要的事情。&lt;/p&gt;
&lt;p&gt;但是有些软件要求必须使用 HTTPS，比如 Vaultwarden，因为它依赖大多数浏览器仅在 HTTPS 才可用的 &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto&quot;&gt;SubtleCrypto API&lt;/a&gt;。[^1] 此外，一些软件在未开启 HTTPS 时，会在页面上显示不安全的提示。还有一些软件若不开启 https ，则会在页面上显示不安全的提示。这时候 https 就有必要了。&lt;/p&gt;
&lt;p&gt;[^1]:&lt;a href=&quot;https://github.com/dani-garcia/vaultwarden/wiki/Enabling-HTTPS&quot;&gt;Enabling HTTPS · dani-garcia/vaultwarden Wiki · GitHub&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;之后我用搜索引擎搜了下有关这方面的内容，大部分都是用通过自签证书实现的。这确实是实现 HTTPS 的一种常见方法，但在多台机器上配置自签证书比较繁琐。&lt;/p&gt;
&lt;p&gt;对于 Tailscale 用户来说，只需要少量配置即可实现 HTTPS。Tailscale 的 Tailnet 提供域名和证书生成功能，通过 &lt;code&gt;tailscale serve&lt;/code&gt; 命令，可以轻松反向代理服务并提供 HTTPS 支持。如果需要更复杂的配置，可以使用 Caddy。Caddy 遇到 &lt;code&gt;*.ts.net&lt;/code&gt; 域名时，会自动从 Tailscale 获取证书。我的个人设备几乎都连接了 Tailscale。&lt;/p&gt;
&lt;h2&gt;如何配置&lt;/h2&gt;
&lt;h3&gt;tailscale serve&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;打开 console 的 &lt;a href=&quot;https://login.tailscale.com/admin/dns&quot;&gt;&lt;strong&gt;DNS&lt;/strong&gt;&lt;/a&gt; 页面。&lt;/li&gt;
&lt;li&gt;确保 MagicDNS 和 HTTPS Certificates 都为开启状态
&lt;img src=&quot;image.png&quot; alt=&quot;DNS Settings&quot;&gt;&lt;/li&gt;
&lt;li&gt;执行以下命令：&lt;pre&gt;&lt;code class=&quot;language-sh&quot;&gt;tailscale serve --bg --https=443 localhost:&amp;lt;port&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;之后，就可以通过在 Tailscale 设置好的域名访问服务了。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;把 serve 换成 funnel，则可以将服务暴露在互联网。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;Caddy&lt;/h3&gt;
&lt;p&gt;从 Caddy 2.5 测试版开始，Caddy 支持与 Tailscale 集成。当 Caddy 收到 &lt;code&gt;*.ts.net&lt;/code&gt; 域名的 HTTPS 请求时，会自动从本地 Tailscale 守护程序获取证书，无需额外配置。&lt;/p&gt;
&lt;p&gt;配置示例如下：&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-sh&quot;&gt;machine-name.domain-alias.ts.net {

  handle_path /vw/* {
    reverse_proxy http://127.0.0.1:8089
  }

  handle_path /alist/* {
    reverse_proxy http://127.0.0.1:5244
  }

}
&lt;/code&gt;&lt;/pre&gt;
</content:encoded></item><item><title>终究还是用回了 Syncthing</title><link>https://icealtria.github.io/blog/syncthing/</link><guid isPermaLink="true">https://icealtria.github.io/blog/syncthing/</guid><description>主要是吐槽 Dropbox</description><pubDate>Wed, 10 Apr 2024 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;我使用过的同步软件&lt;/h2&gt;
&lt;p&gt;我在很长一段时间里一直使用 Dropbox，MegaSync 也用过一段时间。至于为什么选择这两个，是因为主流网盘中提供 Linux 客户端的除了 PCloud 就只有这两个了。&lt;/p&gt;
&lt;p&gt;起初我在用 Mega，因为我将密码管理器从 Bitwarden 更换为 KeePassXC，我想将密码库同步到手机上，但当时 KeePass2Android 不支持。现在虽然支持了，但还没完全支持，例如无法登录开启 &lt;a href=&quot;https://github.com/PhilippC/keepass2android/issues/2415&quot;&gt;2FA&lt;/a&gt; 的账号，而 KeePassDX 也用不了。Dropbox 支持在系统的文件选择器中选择文件，因此手机上的两个软件都可以支持。&lt;/p&gt;
&lt;p&gt;不过我最终还是放弃了这两个云同步软件，只留下了 Syncthing。Syncthing 我其实一直在用，但之前都只是在电脑上使用。对于在手机上使用，我曾担心它会耗电，但后来发现这个担心是多余的。&lt;/p&gt;
&lt;h2&gt;批评 Dropbox&lt;/h2&gt;
&lt;p&gt;为什么要抛弃 Dropbox，那要从我给 Obsidian 写一个插件说起。Obsidian 的插件是用 JavaScript 编写的，每个 JS 项目都会有一坨 &lt;code&gt;node_modules&lt;/code&gt;，然后它把这个文件夹同步过去。&lt;/p&gt;
&lt;p&gt;我以为在 GUI 里设置选择性同步可以忽略掉这个文件夹，但我搞错了。Dropbox 只能用一种很别扭的方式忽略一个文件夹：&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-sh&quot;&gt;# linux
attr -s com.dropbox.ignored -V 1 &amp;#39;/home/yourname/Dropbox (Personal)/YourFileName.pdf&amp;#39;
# windog
Set-Content -Path &amp;#39;C:\Users\yourname\Dropbox(Personal)\YourFileName.pdf&amp;#39; -Stream com.dropbox.ignored -Value 1
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;这就没办法在文件创建之前忽略掉这个文件了，想忽略多个文件还要逐个操作。&lt;/p&gt;
&lt;p&gt;而 syncthing 和 MEGA 只需要简单写个规则。&lt;/p&gt;
&lt;p&gt;不止如此。。。&lt;/p&gt;
&lt;p&gt;Dropbox 只能将本地的一个文件夹与服务器同步，但我不喜欢将一切都放到 &lt;del&gt;/Dropbox。我希望能将 `&lt;/del&gt;/Docs&lt;code&gt;与&lt;/code&gt;%USERPROFILE%/Docs&lt;code&gt;，&lt;/code&gt;~/Books&lt;code&gt;与&lt;/code&gt;D:/Books` 同步。&lt;/p&gt;
&lt;p&gt;Syncthing 和 Mega 都能做到。&lt;/p&gt;
&lt;p&gt;在 Gnome 上 Dropbox 的托盘完全是坏的，这个问题存在了数年，虽然不知道是谁的锅，但只在 Dropbox 上遇到过。右键点击托盘图标打开菜单只能随缘，即便打开显示的状态也是不更新的，永远 &amp;quot;Connecting...&amp;quot;，当然实际上工作的。它只能作为设置页的入口。&lt;/p&gt;
&lt;p&gt;同步相关的功能比 Syncthing 和 Mega 更匮乏，但占用内存却是最大的。&lt;/p&gt;
&lt;p&gt;槽点这么多，那干脆不用了。我都不知道为什么忍了它这么久。&lt;/p&gt;
&lt;p&gt;(说起来 MEGAsync 算是我较为满意的一个网盘了)&lt;/p&gt;
&lt;h2&gt;如何实现 3-2-1 备份&lt;/h2&gt;
&lt;p&gt;我使用同步软件的其中一个原因是希望实现 3-2-1 备份，以避免本地机器故障。所谓 3-2-1 备份策略，即保存三份数据备份，使用两种不同的存储介质，并确保至少有一份备份存储在异地。&lt;/p&gt;
&lt;p&gt;为了实现这个策略，我采用了 Restic 进行定期备份。它支持数据加密和压缩快照。还可以调用 rclone 的服务作为远程 repo。&lt;/p&gt;
&lt;p&gt;具体来说，我编写了一个定期执行的脚本，通过 Restic 进行备份操作。为了确保备份的安全性，我将备份库（repo）的密码存储在 Gnome Keyring 中。脚本会调用 &lt;code&gt;secret-tool&lt;/code&gt; 从 Gnome Keyring 中取出密码，并用来解密备份库进行备份。&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-sh&quot;&gt;restic -r rclone:&amp;lt;remote&amp;gt;:/path/to/repo backup /path/to/data --password-command &amp;#39;secret-tool lookup restic pass&amp;#39;
&lt;/code&gt;&lt;/pre&gt;
</content:encoded></item><item><title>我又回来了</title><link>https://icealtria.github.io/blog/first-post/</link><guid isPermaLink="true">https://icealtria.github.io/blog/first-post/</guid><description>这次要徒手搓博客</description><pubDate>Thu, 21 Sep 2023 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;曾经几度对自己的博客开了又关，最初一个博客应该是在读初中的时候建起来的，使用的是 wordpress。但都没写什么文章，每次想写点什么，就觉得没什么好写的，或者写不出来。。等域名过期或是vps过期，然后也就这么丢掉了。比起写博客还是建博客比较好玩😊况且有了生成式人工智能，写作负担会小很多。&lt;/p&gt;
&lt;h2&gt;框架选择&lt;/h2&gt;
&lt;p&gt;我对前端不是很熟悉，SSG(Static Site Generator) 框架除了主流的 Hexo, Hugo, Jekyll 之外，我几乎不认识其他的。这几个框架在我看来都不是很灵活（不好整活）。&lt;/p&gt;
&lt;p&gt;正好我发现某位页面仔群友也在用重写博客，使用了 Astro。之后我也去了解一下关于这框架的 features，令我比较感兴趣的是 &lt;a href=&quot;https://docs.astro.build/en/concepts/islands/&quot;&gt;Component Islands&lt;/a&gt;，它可以使用任何被支持的UI框架（比如 React, Svelte, Vue）作为组件，还有 MDX，这就相当有利于整活。SSR 的支持也是有的，以后可能会用来显示动态内容，比如评论。于是就选择了 Astro。&lt;/p&gt;
&lt;h2&gt;目标&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;input checked=&quot;&quot; disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; 很快的页面打开速度&lt;/li&gt;
&lt;li&gt;&lt;input checked=&quot;&quot; disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; 无障碍&lt;/li&gt;
&lt;li&gt;&lt;input checked=&quot;&quot; disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; 搜索引擎友好&lt;/li&gt;
&lt;li&gt;&lt;input checked=&quot;&quot; disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; w3m 友好&lt;/li&gt;
&lt;li&gt;&lt;input checked=&quot;&quot; disabled=&quot;&quot; type=&quot;checkbox&quot;&gt; 尽可能避免 JS&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;大概就是灯塔跑分要4个100，最初设定的目标算是达到了。&lt;/p&gt;
&lt;h2&gt;过程记录&lt;/h2&gt;
&lt;h3&gt;设计&lt;/h3&gt;
&lt;p&gt;起初，我打算根据 Material You 的风格来设计我的博客，也就是现在(2023) Google 的设计语言。我模仿了 Material 官网的超大的R角(Radius: 40px)，但后来我发现，过大的圆角严重影响了内容的展示。这里的逻辑是，为了看起来更协调，大圆角需要足够的留白，这就导致了内容展示的空间变少了。有空我一定要写一篇《圆角批判》!&lt;/p&gt;
&lt;p&gt;色彩方面使用了 &lt;a href=&quot;https://m3.material.io/theme-builder&quot;&gt;Material Theme Builder&lt;/a&gt; 进行调色。后面为了方便使用了 &lt;a href=&quot;https://github.com/JavierM42/tailwind-material-colors&quot;&gt;tailwind-material-colors&lt;/a&gt; 作为插件，只要设定一个 primary color 就能计算出其他的颜色，DarkMode 也自动适配好了。 写这篇博客的时候，使用了 &lt;span style=&quot;background-color: #405e0d; color:white&quot;&gt;#405e0d&lt;/span&gt; 作为主题色。以后看心情换。&lt;/p&gt;
&lt;h3&gt;CSS&lt;/h3&gt;
&lt;p&gt;初版使用纯正的 CSS 进行页面布局，写着写着越来越乱了，第一次写规模稍大的页面，不知怎么管理 CSS。后面使用 Tailwind CSS 负担小了很多，首先不用 template 和 css 来回切，不知不觉找不着 tab 了。如果要问为什么不写在 &lt;code&gt;&amp;lt;style&amp;gt;&lt;/code&gt;，因为我不想看到 Network 里一大堆 stylesheet（这什么强迫症），实际上对加载速度也没很大影响。&lt;/p&gt;
&lt;h2&gt;最后的话&lt;/h2&gt;
&lt;p&gt;接下来，我将继续优化和完善这个博客，还有很多想法没实现呢。就这样。&lt;/p&gt;
</content:encoded></item><item><title>折腾日记：尝试将影片库到云端</title><link>https://icealtria.github.io/blog/cloud-jellyfin/</link><guid isPermaLink="true">https://icealtria.github.io/blog/cloud-jellyfin/</guid><description>简单的说下我迁移影片到云端的过程，还有坑。使用的是 alist 和天翼盘。</description><pubDate>Mon, 13 Feb 2023 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;最近，我偶然发现了一个名为 alist 的项目，它能挂载多款国内的网盘，并支持 WebDav 协议。然后我想到了祖传的 10T 天翼网盘。于是，我产生了一个令人兴奋的想法：将 NAS 中的影片移动到网盘上，并使用 webdav 协议在 kodi 中进行播放。在这篇文章中，我将记录下我如何实现这个想法和坑。&lt;/p&gt;
&lt;h2&gt;准备工作&lt;/h2&gt;
&lt;p&gt;首先，我们需要安装 Alist。这是一个非常简单的过程，只需遵循安装说明并进行操作即可。作为安装的方法，我选择了使用 docker compose 进行安装。&lt;/p&gt;
&lt;p&gt;天翼网盘免费版一天只有 2G 上传，想要更大的上传只能购买会员。电信用户可以到积分商城兑换，1000 积分一个月。&lt;/p&gt;
&lt;p&gt;在登录管理面板后，我们需要添加网盘。alist 支持天翼网盘和天翼网盘客户端。对于大于 4 GB 的文件，必须使用天翼网盘客户端。&lt;/p&gt;
&lt;h2&gt;迁移工作&lt;/h2&gt;
&lt;p&gt;既然 alist 支持 WebDav 了，我决定选择使用 rclone 进行文件迁移。sync 命令比通过网页传输方便得多。此外，我还有一些影片尚未刮削元数据，使用 sync 命令可以将我在本地对影片的修改同步到远端。并且如果传输过程中出现问题，也容易处理。&lt;/p&gt;
&lt;h2&gt;评估&lt;/h2&gt;
&lt;p&gt;在使用 alist 把影片迁移到网盘后，我惊讶地发现它的播放效果非常流畅，即使是 16Mbps 的高码率视频，拖动播放进度条也能立即加载。这个体验相比许多在线流媒体服务都更出色。（会员过期后，拖动进度条缓冲时间大概为 1 秒）&lt;/p&gt;
&lt;p&gt;然而，在搜索影片的元数据时，速度可能会有所不足，需要一些等待时间。我猜测这可能是由于文件数量过多，于是我决定删除部分每集的缩略图和不必要的海报以提升速度。然后，我遇到了以下原因不明的异常行为。&lt;/p&gt;
&lt;h2&gt;坑&lt;/h2&gt;
&lt;p&gt;我使用 rclone sync 命令，将我在 NAS 的删除操作同步到远端，但文件只被删除了一部分。命令执行的很快，执行过程中也没发生报错，到 alist 网页中看到文件被删除，但我到网盘页面看到只删除了一部分。接着我刷新 alist 的文件列表，果然还在，这个就很。。到时候再研究下怎么回事了。之前我上传文件的时候出现过几次错误，但之后重试后都顺利完成了（rclone sync 失败后会重新尝试 2 次）。&lt;/p&gt;
&lt;h2&gt;总结&lt;/h2&gt;
&lt;p&gt;总的来说，使用网盘作为影片库与 kodi 观看的体验很不错，但是天翼盘不付费的上传体验糟糕。迁移后 NAS 硬盘空间非常充裕，可以不用买新硬盘了。但 alist 通过 WebDav 进行某些操作文件时不是很稳定，除了视频播放。&lt;/p&gt;
&lt;h2&gt;后记&lt;/h2&gt;
&lt;p&gt;之后换了 Rclone + Jellyfin，Kodi 每次要等打开电视才扫描片库。使用 rclone mount 将 WebDav 挂载到其中一个目录，然后添加到 Jellyfin，体验要远远好于 kodi。&lt;/p&gt;
</content:encoded></item><item><title>CanoKey NFC-A 开箱体验</title><link>https://icealtria.github.io/blog/canokey-unboxing/</link><guid isPermaLink="true">https://icealtria.github.io/blog/canokey-unboxing/</guid><description>Yubikey 平替</description><pubDate>Tue, 02 Feb 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;strong&gt;这是 eraly bird，不是 pigeon。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;说下购买的原因，我一直想买一个替代Key，无奈Yubikey售价太高，然后恰好在某群组看到Canokey发售的消息。&lt;/p&gt;
&lt;p&gt;目前发售的CanoKey拥有Yubikey 5 NFC大部分功能，早起的鸟儿只需要79+10（运费），价格不到Yubikey的四分一。正式版据说也不会太贵。&lt;/p&gt;
&lt;h2&gt;开箱&lt;/h2&gt;
&lt;p&gt;外包装是牛皮纸，看上去很环保。本体有滴胶保护，防水且坚固。
&lt;img src=&quot;https://github.com/icealtria/picx-images-hosting/raw/images/20231022/CanoKey.webp&quot; alt=&quot;Canokey&quot;&gt;&lt;/p&gt;
&lt;h2&gt;它能做什么&lt;/h2&gt;
&lt;p&gt;支持的协议&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;U2F / FIDO2&lt;/li&gt;
&lt;li&gt;OpenPGP&lt;/li&gt;
&lt;li&gt;PIV&lt;/li&gt;
&lt;li&gt;HOTP / TOTP&lt;/li&gt;
&lt;li&gt;NDEF&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Yubikey能做的Canokey基本都能做。我自己平时用的功能大多都覆盖到，除了KeepassXC中的Challenge-Response。并且大部分功能使用方法跟Yubikey一致，甚至还可以使用ykman（YubiKey Manager CLI）管理PIV。所以Canokey支持的特性很多都可以参考&lt;a href=&quot;https://github.com/drduh/YubiKey-Guide&quot;&gt;Yubikey Guide&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;个人最常用的还是U2F，OpenPGP Card。使用U2F作为MFA的一种方式，相比TOTP能更好地对抗钓鱼，社工。而OpenPGP Card可以保护私钥不被盗取。&lt;/p&gt;
&lt;p&gt;另外支持64个FIDO2 resident keys，相比之下Yubikey 5只有25个。&lt;/p&gt;
&lt;h2&gt;不爽的地方&lt;/h2&gt;
&lt;p&gt;客户端是网页的，需要Chromium内核的浏览器。我觉得还是有个本地运行的客户端更好，不过客户端开源，可以clone项目到本地，在node环境运行。&lt;/p&gt;
&lt;p&gt;目前TOTP只在网页使用，很不方便。&lt;/p&gt;
&lt;p&gt;OpenSSH 8.2版本开始支持FIDO/U2F安全密钥。但Canokey只支持ecdsa-sk，不支持ed25519-sk。有点遗憾，但也还好。&lt;/p&gt;
&lt;p&gt;NFC灵敏度要比Yubikey低很多，偶尔会出现失败的现象。&lt;/p&gt;
&lt;h2&gt;总结&lt;/h2&gt;
&lt;p&gt;目前市面上在单个硬件实现多种协议的Key并不多，而且价格对比Yubikey也没有优势。CanoKey能够支持其大部分核心功能，日常使用基本能够满足需求，后续正式版价格不高的话非常值得入手。&lt;/p&gt;
</content:encoded></item></channel></rss>