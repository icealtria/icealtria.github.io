import{a as l,L as u,C as d,X as h,W as m,P as g,f}from"./xrpc.BTJAN-gF.js";const s={"kururin.cc":{metadata:"https://kururin.cc/bsky-oauth-kururin.json",redirect:"https://kururin.cc/oauth/callback"},"icealtria.github.io":{metadata:"https://icealtria.github.io/bsky-oauth.json",redirect:"https://icealtria.github.io/oauth/callback"}},o=window.location.hostname,n=s[o]||s.localhost;if(!s[o]&&o!=="localhost"&&!o.endsWith(".ts.net")){console.warn("Unknown domain for OAuth callback:",o);const t=document.getElementById("status");t&&(t.innerText="Error: Unknown domain configuration. Please check your settings.")}else n&&l({metadata:{client_id:n.metadata,redirect_uri:n.redirect},identityResolver:new u({handleResolver:new h({serviceUrl:"https://public.api.bsky.app"}),didDocumentResolver:new d({methods:{plc:new g,web:new m}})})});async function k(){if(n)try{console.log("[Callback] Starting callback handling..."),console.log("[Callback] Current URL:",location.href),await new Promise(a=>setTimeout(a,100)),console.log("[Callback] LocalStorage keys:",Object.keys(localStorage));let t=location.hash.slice(1);!t&&location.search&&(t=location.search.slice(1));const e=new URLSearchParams(t);if(console.log("[Callback] Params found:",e.toString()),!e.get("code")&&!e.get("error")){const a=document.getElementById("status");if(a&&(a.innerText="Processing..."),!e.toString()){a&&(a.innerText="No OAuth parameters found.");return}}history.replaceState(null,"",location.pathname+location.search);const{session:i}=await f(e),r=i.did||i.sub;r&&localStorage.setItem("bsky_last_did",r),await new Promise(a=>setTimeout(a,200));const c=localStorage.getItem("oauth_return_path")||"/";localStorage.removeItem("oauth_return_path"),window.location.href=c}catch(t){console.error("OAuth callback failed:",t);const e=document.getElementById("status");e&&(e.innerText="Login failed: "+t.message)}}k();
